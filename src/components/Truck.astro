---

---

<div id="truck-container-wrapper" class="relative w-full h-full">
    <svg
        class="absolute top-0 left-0 w-full h-full pointer-events-none"
        preserveAspectRatio="none"
    >
        <path
            id="truck-path"
            d=""
            fill="none"
            stroke="#CBD5E1"
            stroke-width="4"
            stroke-dasharray="12 12"
            stroke-opacity="0.6"></path>
    </svg>

    <!-- Warehouses along the path (Positions will be set via JS based on path) -->
    <div
        class="warehouse-marker absolute w-6 h-6 md:w-8 md:h-8 bg-brand-dark rounded-md shadow-lg flex items-center justify-center opacity-0 transform -translate-x-1/2 -translate-y-1/2 z-10"
        style="top: 20%"
    >
        <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3 md:w-5 md:h-5 text-white"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><path d="M3 21v-8a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8"></path><path
                d="M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14"></path><path
                d="M9 21v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6"></path></svg
        >
    </div>
    <div
        class="warehouse-marker absolute w-6 h-6 md:w-8 md:h-8 bg-brand-primary rounded-md shadow-lg flex items-center justify-center opacity-0 transform -translate-x-1/2 -translate-y-1/2 z-10"
        style="top: 50%"
    >
        <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3 md:w-5 md:h-5 text-white"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><path d="M3 21v-8a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8"></path><path
                d="M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14"></path><path
                d="M9 21v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6"></path></svg
        >
    </div>
    <div
        class="warehouse-marker absolute w-6 h-6 md:w-8 md:h-8 bg-brand-dark rounded-md shadow-lg flex items-center justify-center opacity-0 transform -translate-x-1/2 -translate-y-1/2 z-10"
        style="top: 80%"
    >
        <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3 md:w-5 md:h-5 text-white"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            ><path d="M3 21v-8a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8"></path><path
                d="M5 21V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14"></path><path
                d="M9 21v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6"></path></svg
        >
    </div>

    <!-- Truck Element -->
    <div
        id="truck-element"
        class="absolute top-0 left-0 w-12 h-12 md:w-16 md:h-16 text-brand-primary drop-shadow-2xl z-20 origin-center opacity-0"
    >
        <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="w-full h-full"
        >
            <path
                d="M1 18h18c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v7c0 1.1.9 2 2 2z"
                fill="#1F6AE1"
                stroke="#0A2540"
                stroke-width="1.5"></path>
            <path d="M15 7h4v4h-4z" fill="#A9C9FF"></path>
            <circle
                cx="5.5"
                cy="18.5"
                r="2.5"
                fill="#0A2540"
                stroke="white"
                stroke-width="1"></circle>
            <circle
                cx="15.5"
                cy="18.5"
                r="2.5"
                fill="#0A2540"
                stroke="white"
                stroke-width="1"></circle>
            <path d="M22 13h1v3h-1z" fill="#F59E0B"></path>
            <rect
                x="3"
                y="9"
                width="10"
                height="7"
                rx="1"
                stroke="white"
                stroke-opacity="0.3"
                stroke-width="1"></rect>
            <path
                d="M6 9v7M9 9v7M12 9v7"
                stroke="white"
                stroke-opacity="0.2"
                stroke-width="1"></path>
        </svg>
    </div>
</div>

<script>
    import { gsap } from "gsap";
    import { MotionPathPlugin } from "gsap/MotionPathPlugin";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(MotionPathPlugin, ScrollTrigger);

    function initAnimation() {
        // ... (existing variable declarations)
        const truckElement = document.getElementById("truck-element");
        const pathElement = document.getElementById("truck-path");
        const container = document.getElementById("truck-container-wrapper");
        const parentContainer = document.getElementById("truck-container");
        const markers = document.querySelectorAll(".warehouse-marker");

        if (truckElement && pathElement && container) {
            // 1. Reveal Parent Container
            if (parentContainer) {
                gsap.to(parentContainer, { opacity: 1, duration: 0.5 });
            }

            // 2. Set Path
            const updatePath = () => {
                const width = window.innerWidth;
                const height = window.innerHeight;

                // Responsive positioning
                // Mobile: 85% width (giving ~40-60px space on right depending on resolution)
                // Desktop: 95% width
                const startX = width < 768 ? width * 0.85 : width * 0.95;
                const endX = startX;

                // Create a wobbly vertical path
                let d = `M ${startX} -120 `;
                // Wave bulges to the left
                d += `C ${Math.max(width * 0.5, startX - 80)} ${height * 0.3}, ${Math.min(width, startX + 40)} ${height * 0.4}, ${startX} ${height * 0.6} `;
                d += `C ${Math.max(width * 0.5, startX - 80)} ${height * 0.8}, ${Math.min(width, startX + 40)} ${height * 0.9}, ${endX} ${height + 120} `;

                pathElement.setAttribute("d", d);
                return d;
            };

            const pathData = updatePath();

            // 3. Position Markers on Path
            // Helper to place element on path at progress t [0-1]
            function placeOnPath(element, progress) {
                gsap.to(element, {
                    motionPath: {
                        path: pathElement,
                        align: pathElement,
                        alignOrigin: [0.5, 0.5],
                        start: progress,
                        end: progress,
                        immediateRender: true,
                    },
                    duration: 0,
                });
            }

            if (markers.length >= 3) {
                // Ensure markers use fixed positioning logic or stay relative within container
                placeOnPath(markers[0], 0.2);
                placeOnPath(markers[1], 0.5);
                placeOnPath(markers[2], 0.8);
            }

            // 4. Timeline Animation linked to Scroll
            const tl = gsap.timeline({
                scrollTrigger: {
                    trigger: "body",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 0.5, // Add some smoothing
                },
            });

            // Initial opacity set for truck
            tl.set(truckElement, { opacity: 1 });

            // Truck movement
            tl.to(truckElement, {
                motionPath: {
                    path: pathElement,
                    align: pathElement,
                    autoRotate: true,
                    alignOrigin: [0.5, 0.5],
                },
                ease: "none",
                duration: 1,
            });

            // Markers Pop In
            markers.forEach((marker, i) => {
                let timing = 0.15;
                if (i === 1) timing = 0.45;
                if (i === 2) timing = 0.75;

                // Add to timeline
                tl.to(
                    marker,
                    {
                        opacity: 1,
                        scale: 1,
                        duration: 0.05,
                        ease: "back.out(1.7)",
                    },
                    timing,
                );
            });

            // Handle Resize
            let resizeTimeout;
            window.addEventListener("resize", () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    updatePath();
                    // Re-position markers
                    if (markers.length >= 3) {
                        placeOnPath(markers[0], 0.2);
                        placeOnPath(markers[1], 0.5);
                        placeOnPath(markers[2], 0.8);
                    }
                    ScrollTrigger.refresh();
                }, 200);
            });
        }
    }

    // Run when DOM is ready
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initAnimation);
    } else {
        initAnimation();
    }
</script>
