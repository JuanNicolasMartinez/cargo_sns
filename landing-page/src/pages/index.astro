---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import Hero from "../components/Hero.astro";
import Features from "../components/Features.astro";
import Footer from "../components/Footer.astro";
import Truck from "../components/Truck.astro";
---

<Layout title="CargoSnS | Almacenamiento y Logística Inteligente">
	<div class="fixed inset-0 pointer-events-none z-50 overflow-hidden">
		<div
			id="truck-container"
			class="absolute inset-0 w-full h-full opacity-0"
		>
			<Truck />
		</div>
	</div>

	<Navbar />

	<main class="overflow-x-hidden">
		<!-- Hero Section -->
		<div class="hero-section relative z-10">
			<Hero />
		</div>

		<!-- Features Section -->
		<div class="features-section relative z-20">
			<Features />
		</div>

		<!-- How It Works Section with Scroll Reveal -->
		<section
			id="how-it-works"
			class="py-24 bg-brand-dark text-white relative overflow-hidden z-10"
		>
			<div
				class="absolute top-0 left-0 w-full h-full opacity-20 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] z-0 parallax-bg"
				data-speed="0.5"
			>
			</div>

			<div class="container mx-auto px-6 relative z-10">
				<h2
					class="text-4xl lg:text-5xl font-bold text-center mb-16 section-title"
				>
					<span
						class="text-transparent bg-clip-text bg-gradient-to-r from-brand-primary to-brand-light"
						>Cómo Funciona</span
					>
				</h2>

				<div class="space-y-24">
					<!-- Step 1 -->
					<div
						class="flex flex-col md:flex-row items-center gap-12 step-card opacity-0"
					>
						<div class="w-full md:w-1/2 flex justify-center">
							<div
								class="w-64 h-64 bg-gradient-to-tr from-brand-primary to-brand-light rounded-full blur-[80px] absolute opacity-30 parallax-bg"
								data-speed="0.2"
							>
							</div>
							<div
								class="relative w-full max-w-sm aspect-square bg-white/20 backdrop-blur-2xl border border-white/30 rounded-3xl overflow-hidden shadow-2xl transform -rotate-3 hover:rotate-0 transition-transform duration-500 group"
							>
								<img
									src="https://images.unsplash.com/photo-1553413077-190dd305871c?q=80&w=1000&auto=format&fit=crop"
									alt="Buscar Bodega"
									class="w-full h-full object-cover opacity-80 group-hover:scale-110 transition-transform duration-700"
								/>
								<div
									class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex items-end p-8"
								>
									<div class="text-white">
										<div
											class="text-5xl font-bold opacity-30 mb-2"
										>
											01
										</div>
										<h3 class="text-2xl font-bold">
											Publica o Busca
										</h3>
									</div>
								</div>
							</div>
						</div>
						<div
							class="w-full md:w-1/2 space-y-6 text-center md:text-left info-content"
						>
							<h3 class="text-3xl font-bold">
								Encuentra el espacio perfecto
							</h3>
							<p class="text-xl text-gray-400 leading-relaxed">
								Si tienes mercancía, busca bodegas cercanas. Si
								tienes espacio, publícalo en minutos y empieza a
								monetizar tus m² ociosos.
							</p>
						</div>
					</div>

					<!-- Step 2 -->
					<div
						class="flex flex-col md:flex-row-reverse items-center gap-12 step-card opacity-0"
					>
						<div class="w-full md:w-1/2 flex justify-center">
							<div
								class="w-64 h-64 bg-gradient-to-tr from-brand-light to-white rounded-full blur-[80px] absolute opacity-20 parallax-bg"
								data-speed="0.3"
							>
							</div>
							<div
								class="relative w-full max-w-sm aspect-square bg-white/20 backdrop-blur-2xl border border-white/30 rounded-3xl overflow-hidden shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-500 group"
							>
								<img
									src="https://images.unsplash.com/photo-1580674285054-bed31e145f59?q=80&w=1000&auto=format&fit=crop"
									alt="Transporte"
									class="w-full h-full object-cover opacity-80 group-hover:scale-110 transition-transform duration-700"
								/>
								<div
									class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex items-end p-8"
								>
									<div class="text-white text-right w-full">
										<div
											class="text-5xl font-bold opacity-30 mb-2"
										>
											02
										</div>
										<h3 class="text-2xl font-bold">
											Conecta Transporte
										</h3>
									</div>
								</div>
							</div>
						</div>
						<div
							class="w-full md:w-1/2 space-y-6 text-center md:text-left info-content"
						>
							<h3 class="text-3xl font-bold">
								Logística integrada
							</h3>
							<p class="text-xl text-gray-400 leading-relaxed">
								Solicita transporte verificado para mover tu
								carga desde o hacia la bodega. Rastreo en tiempo
								real incluido.
							</p>
						</div>
					</div>

					<!-- Step 3 -->
					<div
						class="flex flex-col md:flex-row items-center gap-12 step-card opacity-0"
					>
						<div class="w-full md:w-1/2 flex justify-center">
							<div
								class="w-64 h-64 bg-gradient-to-tr from-green-400 to-brand-primary rounded-full blur-[80px] absolute opacity-30 parallax-bg"
								data-speed="0.4"
							>
							</div>
							<div
								class="relative w-full max-w-sm aspect-square bg-white/20 backdrop-blur-2xl border border-white/30 rounded-3xl overflow-hidden shadow-2xl transform -rotate-3 hover:rotate-0 transition-transform duration-500 group"
							>
								<img
									src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1000&auto=format&fit=crop"
									alt="Gestión"
									class="w-full h-full object-cover opacity-80 group-hover:scale-110 transition-transform duration-700"
								/>
								<div
									class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex items-end p-8"
								>
									<div class="text-white">
										<div
											class="text-5xl font-bold opacity-30 mb-2"
										>
											03
										</div>
										<h3 class="text-2xl font-bold">
											Gestiona y Crece
										</h3>
									</div>
								</div>
							</div>
						</div>
						<div
							class="w-full md:w-1/2 space-y-6 text-center md:text-left info-content"
						>
							<h3 class="text-3xl font-bold">Control total</h3>
							<p class="text-xl text-gray-400 leading-relaxed">
								Usa nuestro dashboard para gestionar inventario,
								pagos y reputación. Sube de nivel con nuestro
								sistema de gamificación.
							</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Map CTA Section -->
		<section class="cta-section py-24 relative overflow-hidden z-10">
			<div
				class="absolute inset-0 bg-brand-primary/5 parallax-bg"
				data-speed="0.1"
			>
			</div>
			<div
				class="container mx-auto px-6 relative z-10 text-center space-y-8"
			>
				<h2
					class="cta-title text-4xl font-bold text-brand-dark max-w-3xl mx-auto opacity-0 translate-y-10"
				>
					Únete a la red logística más grande de Latinoamérica
				</h2>
				<p
					class="cta-text text-xl text-gray-600 max-w-2xl mx-auto opacity-0 translate-y-10"
				>
					Empezar es gratis. Solo cobramos una pequeña comisión por
					transacción exitosa.
				</p>

				<div
					class="cta-buttons flex flex-col sm:flex-row justify-center gap-4 pt-8 opacity-0 translate-y-10"
				>
					<button
						class="px-8 py-4 bg-brand-dark text-white font-bold rounded-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all transform"
					>
						Registrar mi Bodega
					</button>
					<button
						class="px-8 py-4 bg-white text-brand-dark border border-gray-200 font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all transform"
					>
						Empezar como Conductor
					</button>
				</div>
			</div>
		</section>
	</main>

	<Footer />
</Layout>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	// --- ANIMATIONS ---

	// Truck animation is handled inside the Truck component

	// 2. Section Titles Reveal
	const titles = document.querySelectorAll(".section-title");
	titles.forEach((title) => {
		gsap.from(title, {
			scrollTrigger: {
				trigger: title,
				start: "top 80%",
				toggleActions: "play none none reverse",
			},
			y: 50,
			opacity: 0,
			duration: 1,
			ease: "power3.out",
		});
	});

	// 3. How It Works Steps (Staggered with 3D effect)
	const steps = document.querySelectorAll(".step-card");
	steps.forEach((step, i) => {
		const direction = i % 2 === 0 ? -100 : 100; // Alternate slide direction

		gsap.fromTo(
			step,
			{ opacity: 0, x: direction, rotateY: direction > 0 ? 15 : -15 },
			{
				scrollTrigger: {
					trigger: step,
					start: "top 75%",
					end: "bottom 20%",
					toggleActions: "play none none reverse", // Re-adds reveal on scroll back
				},
				opacity: 1,
				x: 0,
				rotateY: 0,
				duration: 1.2,
				ease: "power3.out",
			},
		);
	});

	// 4. CTA Section Reveal
	const ctaTl = gsap.timeline({
		scrollTrigger: {
			trigger: ".cta-section",
			start: "top 70%",
		},
	});

	ctaTl
		.to(".cta-title", {
			y: 0,
			opacity: 1,
			duration: 0.8,
			ease: "power3.out",
		})
		.to(
			".cta-text",
			{ y: 0, opacity: 1, duration: 0.8, ease: "power3.out" },
			"-=0.6",
		)
		.to(
			".cta-buttons",
			{ y: 0, opacity: 1, duration: 0.8, ease: "back.out(1.7)" },
			"-=0.6",
		);

	// 5. Parallax Backgrounds
	// Simple parallax effect for elements with .parallax-bg class
	gsap.utils.toArray(".parallax-bg").forEach((bg: any) => {
		const speed = bg.dataset.speed || 0.2;
		gsap.to(bg, {
			y: (i, target) => ScrollTrigger.maxScroll(window) * speed * 0.1, // Basic movement
			ease: "none",
			scrollTrigger: {
				trigger: bg.parentElement || "body",
				start: "top bottom",
				end: "bottom top",
				scrub: true,
			},
		});
	});
</script>
