---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import Hero from "../components/Hero.astro";
import Features from "../components/Features.astro";
import Footer from "../components/Footer.astro";
import Truck from "../components/Truck.astro";
---

<Layout title="CargoSnS | Almacenamiento y Logística Inteligente">
    <Navbar />
    <main class="overflow-x-hidden">
        <!-- Hero Section -->
        <div class="hero-section relative z-10">
            <Hero />
            <div class="absolute inset-0 pointer-events-none z-0">
                <Truck />
            </div>
        </div>

        <!-- Features Section (Features + How It Works) -->
        <div class="features-section relative z-20">
            <Features />
        </div>

        <!-- Map CTA Section -->
        <section class="cta-section py-24 relative overflow-hidden z-10">
            <div
                class="absolute inset-0 bg-brand-primary/5 parallax-bg"
                data-speed="0.1"
            >
            </div>
            <div
                class="container mx-auto px-6 relative z-10 text-center space-y-8"
            >
                <h2
                    class="cta-title text-4xl font-bold text-brand-dark max-w-3xl mx-auto opacity-0 translate-y-10"
                >
                    Únete a la red logística más grande de Latinoamérica
                </h2>
                <p
                    class="cta-text text-xl text-gray-600 max-w-2xl mx-auto opacity-0 translate-y-10"
                >
                    Empezar es gratis. Solo cobramos una pequeña comisión por
                    transacción exitosa.
                </p>

                <div
                    class="cta-buttons flex flex-col sm:flex-row justify-center gap-4 pt-8 opacity-0 translate-y-10"
                >
                    <button
                        class="px-8 py-4 bg-brand-dark text-white font-bold rounded-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all transform"
                    >
                        Registrar mi Bodega
                    </button>
                    <button
                        class="px-8 py-4 bg-white text-brand-dark border border-gray-200 font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all transform"
                    >
                        Empezar como Conductor
                    </button>
                </div>
            </div>
        </section>
    </main>

    <Footer />
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    // --- ANIMATIONS ---

    // Truck animation is handled inside the Truck component

    // 2. Section Titles Reveal
    const titles = document.querySelectorAll(".section-title");
    titles.forEach((title) => {
        gsap.from(title, {
            scrollTrigger: {
                trigger: title,
                start: "top 80%",
                toggleActions: "play none none reverse",
            },
            y: 50,
            opacity: 0,
            duration: 1,
            ease: "power3.out",
        });
    });

    // 3. How It Works Steps (Staggered with 3D effect)
    const steps = document.querySelectorAll(".step-card");
    steps.forEach((step, i) => {
        const direction = i % 2 === 0 ? -100 : 100; // Alternate slide direction

        gsap.fromTo(
            step,
            { opacity: 0, x: direction, rotateY: direction > 0 ? 15 : -15 },
            {
                scrollTrigger: {
                    trigger: step,
                    start: "top 75%",
                    end: "bottom 20%",
                    toggleActions: "play none none reverse", // Re-adds reveal on scroll back
                },
                opacity: 1,
                x: 0,
                rotateY: 0,
                duration: 1.2,
                ease: "power3.out",
            },
        );
    });

    // 4. CTA Section Reveal
    const ctaTl = gsap.timeline({
        scrollTrigger: {
            trigger: ".cta-section",
            start: "top 70%",
        },
    });

    ctaTl
        .to(".cta-title", {
            y: 0,
            opacity: 1,
            duration: 0.8,
            ease: "power3.out",
        })
        .to(
            ".cta-text",
            { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" },
            "-=0.6",
        )
        .to(
            ".cta-buttons",
            { y: 0, opacity: 1, duration: 0.8, ease: "back.out(1.7)" },
            "-=0.6",
        );

    // 5. Parallax Backgrounds
    // Simple parallax effect for elements with .parallax-bg class
    gsap.utils.toArray(".parallax-bg").forEach((bg: any) => {
        const speed = bg.dataset.speed || 0.2;
        gsap.to(bg, {
            y: (i, target) => ScrollTrigger.maxScroll(window) * speed * 0.1, // Basic movement
            ease: "none",
            scrollTrigger: {
                trigger: bg.parentElement || "body",
                start: "top bottom",
                end: "bottom top",
                scrub: true,
            },
        });
    });
</script>
